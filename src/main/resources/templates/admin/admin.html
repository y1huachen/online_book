<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout :: htmlhead(~{::title},~{::style})">
    <style>
        .layui-form-label{
            width: 100px;
        }
        .layui-table th {
            text-align: center;
        }
    </style>
    <title>管理员管理</title>
</head>
<body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
        <!--头-->
        <div th:replace="admin/fragments/head :: header"></div>
        <div class="layui-body">
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                <legend>所有管理员</legend>
            </fieldset>
            <div style="text-align: center;">
                <div class="layui-inline">
                    <table class="layui-table" style="table-layout:fixed;">
                        <colgroup>
                            <col width="150">
                            <col width="150">
                            <col width="200">
                            <col width="100">
                            <col>
                        </colgroup>
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>管理员</th>
                            <th>密码</th>
                            <th>头像</th>
                        </tr>
                        </thead>
                        <tbody id="adminList">
                        <tr>
                            <td>1</td>
                            <td>lican</td>
                            <td>123456</td>
                            <td>none</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="pageList"></div>
            <div style="margin: 10px">
                <button type="button" class="layui-btn layui-btn-radius" id="btn-add">添加管理员</button>
            </div>
        </div>
        <!--底部-->
        <div th:replace="admin/fragments/footer :: footer"></div>
    </div>
<script>
    layui.use(['laypage', 'layer', 'form', 'element'], function(){
        var laypage = layui.laypage
            ,layer = layui.layer
            ,$ = layui.$
            ,form = layui.form
            ,element = layui.element;

        element.init();

        //监听提交
        form.on('submit(add)', function(data){
            $.ajax({
                url:'/admin/admin/add',
                type:'POST',
                dataType:'json',
                data:{name:data.field.name,password:data.field.password},
                success:function (data) {
                    console.log(data);
                    if(data.code==0){
                        layer.closeAll('loading');
                        layer.load(2);
                        layer.msg(data.msg, {icon: 6});
                        setTimeout(function(){
                            window.parent.location.reload();//修改成功后刷新父界面
                        }, 1000);
                        //加载层-风格

                    }else{
                        layer.msg(data.msg, {icon: 5});
                    }
                }
            })
            return false;
        });

        //添加管理员
        $('#btn-add').on('click', function () {
            layer.open({
                type: 1,
                title: '添加管理员',
                maxmin: true,
                area: ['420px', '330px'],
                shadeClose: false, //点击遮罩关闭
                content: $('#addAdmin'),
            });
        });
        //将一段数组分页展示
        function loadAdmin() {
            $.ajax({
                url:'/admin/admin/find/all',
                type:'GET',
                success:function (data) {
                    console.log(data);
                    if(data!=null){
                        layer.closeAll('loading');
                        layer.msg("获取所有管理员成功", {icon: 6,time: 1000});
                        //调用分页
                        laypage.render({
                            elem: 'pageList'
                            ,count: data.length
                            ,jump: function(obj){
                                //模拟渲染
                                document.getElementById('adminList').innerHTML = function(){
                                    var arr = []
                                        ,thisData = data.concat().splice(obj.curr*obj.limit - obj.limit, obj.limit);
                                    layui.each(thisData, function(index, item){
                                        arr.push('<tr>'+ '<td>' + item['id'] + '</td>'
                                            + '<td>' + item['name'] + '</td>'
                                            + '<td>' + item['password'] + '</td>'
                                            + '<td>' + '<img src="/upload/images/'+ item['avatarUrl'] + '" class="layui-nav-img"/>'
                                            + '</td>' + '</tr>');
                                    });
                                    return arr.join('');
                                }();
                            }
                        });

                    }else{
                        layer.msg("获取所有管理员失败", {icon: 5});
                    }
                }
            })
        }

        loadAdmin();

    });
</script>
<div id="addAdmin" style="display: none">
    <form class="layui-form" action="" style="margin-top:20px" method="post">
        <div class="layui-form-item">
            <label class="layui-form-label">管理员名称</label>
            <div class="layui-input-inline">
                <input type="text" name="name"  required  lay-verify="required" autocomplete="off" placeholder="请输入管理员名称" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">密码</label>
            <div class="layui-input-inline">
                <input type="text" name="password"  required  lay-verify="required" autocomplete="off" placeholder="请输入密码" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item" style="margin-top:40px">
            <div class="layui-input-block">
                <button class="layui-btn  layui-btn-submit " lay-submit="" lay-filter="add">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>
</div>
</body>
</html>